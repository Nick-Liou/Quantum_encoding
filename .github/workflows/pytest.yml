name: Tests

on: [push, pull_request]

jobs:
  test:
    name: Run pytest
    runs-on: ubuntu-latest
    
    steps:
        - name: Checkout repository
          uses: actions/checkout@v4          
          with:
            token: ${{ secrets.PAT }}
            fetch-depth: 2
         
        - name: Set up Python
          uses: actions/setup-python@v5
          with:
            python-version: 3.9
        
        -   name: Install dependencies
            run: |
                pip install pytest
        
        # -   name: Run pytest
        #     run: |
        #         pytest 

        
        -   name: Find modified Python files
            id: find_files
            run: |
                echo "files=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep '\.py$' || true)" >> $GITHUB_STATE
      
        -   name: Run pytest on modified files
            run: |
                pytest $files
